<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Majestic Competitor Comparison</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>

  <style>
    canvas { display: block; width: 100% !important; }
    #barChart { height: 220px; }
    #gaugeChart { height: 120px; }

    .fade-in {
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    .fade-in.show {
      opacity: 1;
      transform: translateY(0);
    }
    .autocomplete-wrapper {
      position: relative;
    }
    #autocompleteList {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      z-index: 50;
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      max-height: 12rem;
      overflow-y: auto;
    }

    #autocompleteList.hidden {
      display: none !important;
    }

    #autocompleteList li {
      padding: 10px 14px;
      cursor: pointer;
      transition: background 0.15s ease;
    }

    #autocompleteList li:hover {
      background: #f3f4f6;
    }
  </style>
</head>

<body class="bg-gray-100 font-sans text-gray-800">
  <header class="bg-[#ab1f2d] text-white p-6 shadow-md">
  </header>

  <!-- Search -->
  <section class="p-6 flex justify-center">
    <div class="w-full max-w-lg">
      <label class="block text-gray-700 font-semibold mb-2" for="productInput">Competitor Product Number</label>
      <div class="autocomplete-wrapper">
        <div class="flex">
          <input id="productInput" type="text" placeholder="e.g., 34-8743"
            class="flex-1 px-4 py-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-[#ab1f2d]" />
          <button id="searchBtn"
            class="bg-[#ab1f2d] text-white px-4 py-2 rounded-r-lg hover:opacity-90 transition"
            type="button">Search</button>
        </div>
        <ul id="autocompleteList" class="hidden"></ul>
      </div>

      <p id="searchError" class="text-red-600 text-sm mt-2 font-semibold hidden">
        *Product information not found
      </p>

      <p class="text-xs text-gray-500 mt-2">
        Enter a competitor model number to generate a side-by-side comparison.
      </p>
    </div>
  </section>

  <!-- Dashboard -->
  <main id="dashboard" class="hidden space-y-6 max-w-6xl mx-auto px-6 pb-10">

    <!-- Top Info Cards -->
    <section id="topCards" class="grid grid-cols-1 md:grid-cols-3 gap-6 fade-in">
      <div class="bg-white p-6 rounded-2xl shadow-lg h-full flex flex-col">
        <h3 class="text-gray-600 text-xs uppercase mb-2">Competitor</h3>
        <p id="competitorName" class="text-2xl font-bold text-[#707070]">—</p>
        <p id="competitorPart" class="text-lg font-semibold text-gray-600">—</p>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow-lg h-full flex items-center space-x-4">
        <img id="majesticImage" src="" alt="Majestic product image"
          class="h-32 w-auto rounded-lg shadow-sm object-contain bg-white" />
        <div>
          <h3 class="text-gray-600 text-xs uppercase mb-2">Majestic Part</h3>
          <p id="majesticPart" class="text-2xl font-bold text-[#ab1f2d]">—</p>
          <p id="majesticName" class="text-lg font-semibold text-gray-800">—</p>
        </div>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow-lg h-full flex flex-col justify-center">
        <p class="text-sm text-gray-500 uppercase mb-1">Comparison Summary</p>
        <p id="comparisonSummary" class="italic text-gray-700 leading-snug">—</p>
      </div>
    </section>

    <!-- Charts + Table -->
    <section id="chartsAndTable" class="grid grid-cols-1 md:grid-cols-2 gap-8 fade-in">
      <div class="flex flex-col space-y-6">
        <div class="bg-white p-6 rounded-2xl shadow-lg h-[300px] flex flex-col">
          <h2 class="text-lg font-semibold mb-3">ANSI/ISEA 105 Comparison</h2>
          <div class="h-[220px]"><canvas id="barChart"></canvas></div>
        </div>

        <!-- Added id for gauge section -->
        <div id="gaugeChartSection" class="bg-white p-6 rounded-2xl shadow-lg h-[200px] flex flex-col">
          <h2 class="text-lg font-semibold mb-3">Glove Gauge Comparison</h2>
          <div class="h-[120px]"><canvas id="gaugeChart"></canvas></div>
        </div>
      </div>

      <aside class="bg-white p-6 rounded-2xl shadow-lg fade-in">
        <h2 class="text-lg font-semibold mb-4">Product Specs</h2>
        <div class="overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead>
              <tr class="text-sm text-gray-500 border-b">
                <th class="pb-2">Field</th>
                <th class="pb-2">Competitor</th>
                <th class="pb-2">Majestic</th>
              </tr>
            </thead>
            <tbody id="specTableBody" class="text-sm"></tbody>
          </table>
        </div>
      </aside>
    </section>

    <section id="finalSummary" class="fade-in bg-white rounded-2xl shadow-xl p-10 text-center border border-gray-100">
      <h2 class="text-2xl font-bold text-[#ab1f2d] mb-3">Why Choose Majestic?</h2>
      <p id="whyMajestic" class="text-gray-700 max-w-3xl mx-auto mb-6 leading-relaxed">—</p>

      <a id="learnMoreLink" href="#"
        class="inline-block mt-2 bg-[#ab1f2d] text-white font-semibold px-8 py-3 rounded-xl shadow-md hover:bg-[#911b26] transition">
        Learn More
      </a>
    </section>

    <p class="text-xs text-gray-400 mt-4 italic">
      Competitor part number information is based on publicly available data as of October 2025.
      Majestic Glove is not responsible for any errors or omissions.
    </p>
  </main>

  <script>
    Chart.defaults.animation = {
      duration: 900,
      easing: 'easeOutQuart'
    };

    let productsData = {};
    const charts = { bar: null, gauge: null };

    async function loadProducts() {
      try {
        const response = await fetch('https://majesticglove.github.io/Majestic/majestic_comparison.json');
        productsData = await response.json();
      } catch (err) {
        console.error("Failed to load products.json:", err);
      }
    }

    function ratingToNum(r) {
      const m = String(r || "").trim().toUpperCase().match(/^A?(\d+)$/);
      return m ? parseInt(m[1], 10) : 0;
    }

    function destroyCharts() {
      Object.values(charts).forEach(c => c?.destroy());
    }

    function extractLiner(materialStr) {
      if (!materialStr) return "—";
      const match = materialStr.match(/([^,]*liner[^,]*)/i);
      return match ? match[1].trim() : materialStr;
    }

    function renderSpecTable(comp, maj) {
      const rows = [
        ["Country of Origin", comp.country, maj.country],
        ["Liner Material", comp.linerMaterial, extractLiner(maj.material)],
        ["Material Coating", comp.coating, maj.coating],
        ["Features", (comp.features?.length ? comp.features.join(", ") : null),
                     (maj.features?.length ? maj.features.join(", ") : null)],
        ["Cut (ANSI)", comp.ratings.cut, maj.ratings.cut],
        ["Abrasion (ANSI)", comp.ratings.abrasion, maj.ratings.abrasion],
        ["Puncture (ANSI)", comp.ratings.puncture, maj.ratings.puncture],
        ["Gauge", comp.gauge, maj.gauge]
      ];

      const tbody = document.getElementById("specTableBody");

      tbody.innerHTML = rows
        .filter(([_, c, m]) => c != null || m != null)
        .map(([f, c, m]) => `
          <tr class="border-t">
            <td class="py-3 pr-4 font-medium">${f}</td>
            <td class="py-3 pr-4">${c ?? "—"}</td>
            <td class="py-3 pr-4">${m ?? "—"}</td>
          </tr>
        `).join("");
    }

    function renderBarChart(comp, maj) {
      const ctx = document.getElementById("barChart").getContext("2d");
      charts.bar?.destroy();
      charts.bar = new Chart(ctx, {
        type: "bar",
        data: {
          labels: ["Cut", "Abrasion", "Puncture"],
          datasets: [
            { label: comp.name, data: [ratingToNum(comp.ratings.cut), ratingToNum(comp.ratings.abrasion), ratingToNum(comp.ratings.puncture)], backgroundColor: "#707070", borderRadius: 6 },
            { label: `Majestic ${maj.part}`, data: [ratingToNum(maj.ratings.cut), ratingToNum(maj.ratings.abrasion), ratingToNum(maj.ratings.puncture)], backgroundColor: "#ab1f2d", borderRadius: 6 }
          ]
        },
        options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }, plugins: { legend: { position: "bottom" } } }
      });
    }

    function renderGaugeChart(comp, maj) {
      const ctx = document.getElementById("gaugeChart").getContext("2d");
      charts.gauge?.destroy();
      charts.gauge = new Chart(ctx, {
        type: "bar",
        data: {
          labels: [`Majestic ${maj.part}`, comp.part],
          datasets: [{ data: [maj.gauge, comp.gauge], backgroundColor: ["#ab1f2d", "#707070"], barThickness: 18, borderRadius: 6 }]
        },
        options: { indexAxis: "y", responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
      });
    }

    function showComparison(compKey) {
      const key = compKey.trim().toUpperCase();
      const product = Object.entries(productsData).find(([k]) => k.toUpperCase() === key)?.[1];
      if (!product) {
        document.getElementById("searchError").textContent = "*Product information not found";
        document.getElementById("searchError").classList.remove("hidden");
        return;
      }
      document.getElementById("searchError").classList.add("hidden");

      const { competitor: comp, majestic: maj } = product;
      document.getElementById("dashboard").classList.remove("hidden");

      document.querySelectorAll(".fade-in").forEach(el => {
        el.classList.remove("show");
        setTimeout(() => el.classList.add("show"), 100);
      });

      document.getElementById("competitorName").textContent = comp.name;
      document.getElementById("competitorPart").textContent = comp.part;
      document.getElementById("majesticPart").textContent = maj.part;
      document.getElementById("majesticName").textContent = maj.name;
      document.getElementById("comparisonSummary").textContent = product.summary;
      document.getElementById("whyMajestic").textContent = product.whyMajestic;

      const imgEl = document.getElementById("majesticImage");
      imgEl.src = "https://" + maj.image.replace(/^https?:\/\//, ""); 
      imgEl.alt = `${maj.name} image`;

      // Build Jotform URL
      const jotformBase = "https://form.jotform.com/252043751845154";
      const whatChallenges = `We are interested in learning more about the differences between the ${comp.name} ${comp.part} and the ${maj.name} ${maj.part}.`;
      const whatSafety = `${comp.name} ${comp.part}`;
      const doYou = "Yes";
      const jotformUrl = `${jotformBase}?whatChallenges=${encodeURIComponent(whatChallenges)}&whatSafety=${encodeURIComponent(whatSafety)}&doYou=${encodeURIComponent(doYou)}`;
      document.getElementById("learnMoreLink").href = jotformUrl;

      renderSpecTable(comp, maj);
      destroyCharts();
      renderBarChart(comp, maj);

      // Hide gauge section if both gauges are empty/0
      const gaugeSection = document.getElementById("gaugeChartSection");
      if ((!comp.gauge || comp.gauge === 0) && (!maj.gauge || maj.gauge === 0)) {
        gaugeSection.style.display = "none";
      } else {
        gaugeSection.style.display = "block";
        renderGaugeChart(comp, maj);
      }
    }

    // Search setup
    const searchBtn = document.getElementById("searchBtn");
    const inputEl = document.getElementById("productInput");
    searchBtn.disabled = true;

    loadProducts().then(() => {
      searchBtn.disabled = false;
    });

    searchBtn.addEventListener("click", () => {
      const val = inputEl.value.trim();
      if (!val) {
        document.getElementById("searchError").textContent = "*Please enter a product number";
        document.getElementById("searchError").classList.remove("hidden");
        return;
      }
      document.getElementById("searchError").classList.add("hidden");
      showComparison(val);
    });

    inputEl.addEventListener("keydown", e => { if (e.key === "Enter") searchBtn.click(); });

    // Autocomplete
    inputEl.addEventListener("input", () => {
      const query = inputEl.value.trim().toUpperCase();
      const listEl = document.getElementById("autocompleteList");
      if (!query) { listEl.innerHTML = ""; listEl.classList.add("hidden"); return; }

      const keys = Object.keys(productsData);
      const matches = keys.filter(k => k.toUpperCase().includes(query)).slice(0, 4);

      if (matches.length === 0) { listEl.innerHTML = ""; listEl.classList.add("hidden"); return; }

      listEl.innerHTML = matches.map(m => `<li class="px-4 py-2 cursor-pointer hover:bg-gray-100">${m}</li>`).join("");
      listEl.classList.remove("hidden");

      Array.from(listEl.children).forEach(li => {
        li.addEventListener("click", () => {
          inputEl.value = li.textContent;
          listEl.classList.add("hidden");
          searchBtn.click();
        });
      });
    });
  </script>
</body>
</html>
